<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <title>YBlog - Accroître le pouvoir des languages déficients.</title>
        <meta name="keywords" content="m4, SVG, XSLT, XML, design, programmation, fractales" />

        <link rel="shortcut icon" type="image/x-icon" href="../../../../Scratch/img/favicon.ico" />
        <link rel="stylesheet" type="text/css" href="../../../../Scratch/css/brutalist.css" />
        <link rel="stylesheet" type="text/css" href="/css/legacy.css" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="apple-touch-icon" href="../../../../Scratch/img/about/FlatAvatar@2x.png" />
        <!--[if lt IE 9]>
        <script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script>
        <![endif]-->
        <!-- IndieAuth -->
        <link href="https://twitter.com/yogsototh" rel="me">
        <link href="https://github.com/yogsototh" rel="me">
        <link href="mailto:yann.esposito@gmail.com" rel="me">
        <link rel="pgpkey" href="../../../../pubkey.txt">
    </head>
    <body lang="fr" class="article">
        <div id="content">
	        			<div id="header">
			    <div id="choix">
        	    <span id="choixlang">
                  <a href="../../../../Scratch/en/blog/SVG-and-m4-fractals/">Anglais</a> 
        	    </span>
              <span class="tomenu"><a href="#navigation">↓ Menu ↓</a></span>
        	    <span class="flush"></span>
        	</div>
			</div>

			<div id="titre">
				<h1>Accroître le pouvoir des languages déficients.</h1>
				<h2>Fractales en SVG avec m4</h2>

			</div>
			<div class="flush"></div>
      <div id="afterheader" class="article">
          <div class="corps">
              <div>
<img src="../../../../Scratch/img/blog/SVG-and-m4-fractals/main.png" alt="Yesod logo made in SVG and m4" />
</div>
<div class="intro">
<p><span class="sc"><abbr title="Trop long; pas lu">tlpl</abbr>: </span> Utiliser m4 pour accroître le pouvoir d’<span class="sc">xslt</span> et d’<span class="sc">svg</span>. Example cool, les fractales.</p>
</div>
<p>Lorsqu’<span class="sc">xml</span> fût inventé beaucoup pensaient que c’était l’avenir. Passer de fichiers plat à des fichiers structurés standardisés fût un grand progrès dans beaucoup de domaines. Cerain se mirent à voir du <span class="sc">xml</span> de partout. À tel point que les les format compatibles <span class="sc">xml</span> naquirent de toute part. Non seulement comme format de fichier, mais aussi comme format pour un langage de programmation.</p>
<p>Ô joie !</p>
<p>Malheureusement, <span class="sc">xml</span> fût fabriquer pour le transfert de données. Pas du tout pour être vu ou édité directement. La triste vérité est qu’<span class="sc">xml</span> est verbeux et laid. Dans un monde parfait, nous ne devrions avoir des programmes qui s’occupent de nous afficher correctement le <span class="sc">xml</span> pour nous épargner la peine de les voir directement. Mais devinez quoi ? Notre monde n’est pas parfait. Beaucoup de programmeurs sont ainsi forcé de travailler directement avec de l’<span class="sc">xml</span>.</p>
<p><span class="sc">xml</span>, n’est pas le seul cas de format mal utilisé que je connaisse. Vous avez d’autres formats dans lesquels il serait très agréable d’ajouter des variables, des boucles, des fonctions…</p>
<p>Mais je suis là pour vous aider. Si comme moi vous détestez <span class="sc">xslt</span> ou écrire de l’<span class="sc">xml</span>. Je vais vous montrer une façon d’améliorer tout ça.</p>
<h2 id="un-exemple-avec-xslt">Un exemple avec <span class="sc">xslt</span></h2>
<p>Commençons avec le pire cas de langage <span class="sc">xml</span> que je connaisse : <span class="sc">xslt</span>. Tous les développeurs qui ont déjà dû écrire du <span class="sc">xslt</span> savent à quel point ce langage est horrible.</p>
<p>Pour réduire la “verbosité” de tels langages, il y a un moyen. <strong><code>m4</code></strong>. Oui, le préprocesseur utilisé par <code>C</code> et <code>C++</code>.</p>
<p>Voici certains exemples&nbsp;:</p>
<ul>
<li>Les variables, au lieu d’écrire <code>myvar = value</code>, voici la version <sc>xslt</sc> :</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">&lt;xsl:variable</span><span class="ot"> name=</span><span class="st">&quot;myvar&quot;</span><span class="ot"> select=</span><span class="st">&quot;value&quot;</span><span class="kw">/&gt;</span></a></code></pre></div>
<ul>
<li>Afficher quelquechose. Au lieu de <code>print "Hello world!"</code>, <sc>xslt</sc> nous offre :</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">&lt;xsl:text</span> </a>
<a class="sourceLine" id="cb2-2" title="2"><span class="ot">    disable-output-escaping=</span><span class="st">&quot;yes&quot;</span><span class="kw">&gt;</span><span class="bn">&lt;![CDATA[</span>Hello world!</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="bn">]]&gt;</span><span class="kw">&lt;/xsl:text&gt;</span></a></code></pre></div>
<ul>
<li>afficher la valeur d’une variable, au lieu de <code>print myvar</code>, nous avons droit à :</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">&lt;xslt:value-of</span><span class="ot"> select=</span><span class="st">&quot;myvar&quot;</span><span class="kw">/&gt;</span></a></code></pre></div>
<ul>
<li>Essayez d’imaginer à quel point il est verbeux de déclarer une fonction dans ce langage.</li>
</ul>
<h2 id="la-solution-m4-à-la-rescousse">La solution (m4 à la rescousse)</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot; standalone=&quot;yes&quot;<span class="kw">?&gt;</span> <span class="co">&lt;!-- YES its &lt;span class=&quot;sc&quot;&gt;xml&lt;/span&gt; --&gt;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">&lt;!-- ← start a comment, then write some m4 directives:</span></a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">define(`ydef',`&lt;xsl:variable name=&quot;$1&quot; select=&quot;$2&quot;/&gt;')</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">define(`yprint',`&lt;xsl:text disable-output-escaping=&quot;yes&quot;&gt;&lt;![CDATA[$1]]&gt;&lt;/xsl:text&gt;')</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">define(`yshow',`&lt;xsl:value-of select=&quot;$1&quot;/&gt;')</span></a>
<a class="sourceLine" id="cb4-7" title="7"></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">--&gt;</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">&lt;!-- Yes, &lt;span class=&quot;sc&quot;&gt;xml&lt;/span&gt; sucks to be read --&gt;</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="kw">&lt;xsl:stylesheet</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> xmlns:xsl=</span><span class="st">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">&lt;!-- And it sucks even more to edit --&gt;</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="kw">&lt;xsl:template</span><span class="ot"> match=</span><span class="st">&quot;/&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb4-13" title="13">    ydef(myvar,value)</a>
<a class="sourceLine" id="cb4-14" title="14">    yprint(Hello world!)</a>
<a class="sourceLine" id="cb4-15" title="15">    yshow(myvar)</a>
<a class="sourceLine" id="cb4-16" title="16"><span class="kw">&lt;/xsl:template&gt;</span></a></code></pre></div>
<p>Maintenant compilons simplement ce fichier&nbsp;:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode zsh"><code class="sourceCode zsh"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">m4</span> myfile.m4 <span class="kw">&gt;</span> myfile.xslt</a></code></pre></div>
<p>Et vous pouvez profitez ! Maintenant <sc>xslt</sc> devient plus lisible et plus facile à éditer.</p>
<h2 id="la-partie-la-plus-cool-les-fractales">La partie la plus cool: les fractales !</h2>
<p>À ses débuts, beaucoup pensaient que ce serait le nouveau Flash. Apparemment, ce devrait plutôt être <code>canvas</code> avec du javascript qui occupera cette place.</p>
<p>Tout d’abord, laissez moi vous montrer le résultat&nbsp;:</p>
<a href="../../../../Scratch/img/blog/SVG-and-m4-fractals/main.svg">
<div>
<img src="../../../../Scratch/img/blog/SVG-and-m4-fractals/main.png" alt="Yesod logo made in SVG and m4" />
</div>
<p>Cliquez sur l’image pour voir le <span class="sc">svg</span> directement. Attention, si vous n’avez pas un ordinateur récent, ça risque de ramer. </a></p>
<p>Le positionnement du texte “esod” par rapport au “λ” renversé a été en jouant avec firebug. De cette façon je n’avais pas à regénérer pour tester.</p>
<p>Faire une telle fractale revient à&nbsp;:</p>
<ol type="1">
<li>Choisir un élément racine ;</li>
<li>le dupliquer et le transformer ;</li>
<li>le résultat est un nouveau sous-élément ;</li>
<li>répéter à partir de 2 mais en utilisant le sous-élément comme nouvelle racine.</li>
<li>Arréter lorsque la récursion est assez profonde.</li>
</ol>
<p>Si j’avais dû faire ça manuellement, il m’aurait fallu faire beaucoup de copier/coller dans mon <span class="sc">svg</span>. Simplement parce que la transformation est toujours la même, mais je ne pouvais pas dire, utiliser la transformation appelée “titi”. Plutôt que copier du <span class="sc">xml</span>, j’ai utilisé m4.</p>
<p>Et voici le code commenté&nbsp;:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;<span class="kw">?&gt;</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co">&lt;!--</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">     M4 Macros</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">define(`YTRANSFORMONE', `scale(.43) translate(-120,-69) rotate(-10)')</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">define(`YTRANSFORMTWO', `scale(.43) translate(-9,-67.5) rotate(10)')</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">define(`YTRANSFORMTHREE', `scale(.43) translate(53,41) rotate(120)')</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">define(`YGENTRANSFORM', `translate(364,274) scale(3)')</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">define(`YTRANSCOMPLETE', `</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">    &lt;g id=&quot;level_$1&quot;&gt;</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">        &lt;use style=&quot;opacity: .8&quot; transform=&quot;YTRANSFORMONE&quot; xlink:href=&quot;#level_$2&quot; /&gt;</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">        &lt;use style=&quot;opacity: .8&quot; transform=&quot;YTRANSFORMTWO&quot; xlink:href=&quot;#level_$2&quot; /&gt;</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">        &lt;use style=&quot;opacity: .8&quot; transform=&quot;YTRANSFORMTHREE&quot; xlink:href=&quot;#level_$2&quot; /&gt;</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">    &lt;/g&gt;</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">    &lt;use transform=&quot;YGENTRANSFORM&quot; xlink:href=&quot;#level_$1&quot; /&gt;</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">')</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="co"> --&gt;</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="kw">&lt;svg</span> </a>
<a class="sourceLine" id="cb6-18" title="18"><span class="ot">    xmlns=</span><span class="st">&quot;http://www.w3.org/2000/svg&quot;</span> </a>
<a class="sourceLine" id="cb6-19" title="19"><span class="ot">    xmlns:xlink=</span><span class="st">&quot;http://www.w3.org/1999/xlink&quot;</span></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="ot">    x=</span><span class="st">&quot;64&quot;</span><span class="ot"> y=</span><span class="st">&quot;64&quot;</span><span class="ot"> width=</span><span class="st">&quot;512&quot;</span><span class="ot"> height=</span><span class="st">&quot;512&quot;</span><span class="ot"> viewBox=</span><span class="st">&quot;64 64 512 512&quot;</span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="ot">    id=</span><span class="st">&quot;svg2&quot;</span><span class="ot"> version=</span><span class="st">&quot;1.1&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb6-22" title="22">    <span class="kw">&lt;g</span><span class="ot"> id=</span><span class="st">&quot;level_0&quot;</span><span class="kw">&gt;</span> <span class="co">&lt;!-- some group, if I want to add other elements --&gt;</span></a>
<a class="sourceLine" id="cb6-23" title="23">        <span class="co">&lt;!-- the text &quot;λ&quot; --&gt;</span></a>
<a class="sourceLine" id="cb6-24" title="24">        <span class="kw">&lt;text</span><span class="ot"> id=</span><span class="st">&quot;lambda&quot;</span> </a>
<a class="sourceLine" id="cb6-25" title="25"><span class="ot">            fill=</span><span class="st">&quot;#333&quot;</span><span class="ot"> style=</span><span class="st">&quot;font-family:Ubuntu; font-size: 100px&quot;</span></a>
<a class="sourceLine" id="cb6-26" title="26"><span class="ot">            transform=</span><span class="st">&quot;rotate(180)&quot;</span><span class="kw">&gt;</span>λ<span class="kw">&lt;/text&gt;</span></a>
<a class="sourceLine" id="cb6-27" title="27">    <span class="kw">&lt;/g&gt;</span></a>
<a class="sourceLine" id="cb6-28" title="28">    <span class="co">&lt;!-- the text &quot;esod&quot; --&gt;</span></a>
<a class="sourceLine" id="cb6-29" title="29">    <span class="kw">&lt;text</span> </a>
<a class="sourceLine" id="cb6-30" title="30"><span class="ot">        fill=</span><span class="st">&quot;#333&quot;</span> </a>
<a class="sourceLine" id="cb6-31" title="31"><span class="ot">        style=</span><span class="st">&quot;font-family:Ubuntu; font-size: 28px; letter-spacing: -0.10em&quot;</span> </a>
<a class="sourceLine" id="cb6-32" title="32"><span class="ot">        x=</span><span class="st">&quot;-17.3&quot;</span> </a>
<a class="sourceLine" id="cb6-33" title="33"><span class="ot">        y=</span><span class="st">&quot;69&quot;</span> </a>
<a class="sourceLine" id="cb6-34" title="34"><span class="ot">        transform=</span><span class="st">&quot;YGENTRANSFORM&quot;</span><span class="kw">&gt;</span>esod<span class="kw">&lt;/text&gt;</span></a>
<a class="sourceLine" id="cb6-35" title="35">    <span class="co">&lt;!-- ROOT ELEMENT --&gt;</span></a>
<a class="sourceLine" id="cb6-36" title="36">    <span class="kw">&lt;use</span><span class="ot"> transform=</span><span class="st">&quot;YGENTRANSFORM&quot;</span><span class="ot"> xlink:href=</span><span class="st">&quot;#level_0&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb6-37" title="37"></a>
<a class="sourceLine" id="cb6-38" title="38">    YTRANSCOMPLETE(1,0) <span class="co">&lt;!-- First recursion --&gt;</span></a>
<a class="sourceLine" id="cb6-39" title="39">    YTRANSCOMPLETE(2,1) <span class="co">&lt;!-- deeper --&gt;</span></a>
<a class="sourceLine" id="cb6-40" title="40">    YTRANSCOMPLETE(3,2) <span class="co">&lt;!-- deeper --&gt;</span></a>
<a class="sourceLine" id="cb6-41" title="41">    YTRANSCOMPLETE(4,3) <span class="co">&lt;!-- even deeper --&gt;</span></a>
<a class="sourceLine" id="cb6-42" title="42">    YTRANSCOMPLETE(5,4) <span class="co">&lt;!-- Five level seems enough --&gt;</span></a>
<a class="sourceLine" id="cb6-43" title="43"><span class="kw">&lt;/svg&gt;</span></a></code></pre></div>
<p>et je l’ai compile en <sc>svg</sc> et ensuite en <sc>png</sc> avec&nbsp;:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode zsh"><code class="sourceCode zsh"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">m4</span> yesodlogo.m4 <span class="kw">&gt;</span> yesodlogo.svg <span class="kw">&amp;&amp;</span> convert yesodlogo.svg yesodlogo.png</a></code></pre></div>
<p>Le λ est dupliqué avec trois “transformations” différentes. Les transformations sont : <code>YTRANSFORMONE</code>, <code>YTRANSFORMTWO</code> et <code>YTRANSFORMTHREE</code>.</p>
<p>Chaque transformation est une similarité (translation + rotation + zoom, ce qui est équivalent à juste rotation + zoom, mais bon).</p>
<p>Une fois fixée chaque transformation peut ensuite être réutilisée pour chaque nouveau niveau.</p>
<p>Maintenant <code>YTRANSCOMPLETE</code> entre en jeu. Cette macro prend deux arguments. Le niveau courant et le niveau précédent. Cette macro va dupliquer le niveau précédent en lui appliquant chacune des 3 transformations. Au niveau 0, le contenu est un seul grand λ, le niveau 1 en contient 3. Le niveau 2 en contient 9, etc… Le niveau 5 contient 3<sup>5</sup>=243 λ. Tous les niveaux combinés représentent 3<sup>6</sup>-1 / 2 = 364 λ.</p>
<p>L’avantage principal c’est que je pouvais visualiser le résultat final facilement. Sans ce système de macro, pour faire une preview il m’aurait fallu faire des copier/coller + quelques modifications à chaque essai.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Ce fut très amusant de faire une fractale en <sc>svg</sc>, mais la partie la plus intéressante était d’augmenter la puissance d’expressivité du langage en utilise un préprocesseur. J’ai utilisé cette méthode avec <sc>xslt</sc> pour une vrai application par exemple. On peut aussi utiliser m4 pour faire des includes d’autres fichiers. Typiquement je l’ai utiliser pour les includes dans un format obscur. Mais vous pouvez aussi le considérer pour des includes dans du HTML. Par exemple pour fabriquer un site statique rapidement, m4 peut se révéler utile pour inclure un footer ou un menu sur toutes les pages par exemple. J’ai aussi pensé que l’on pouvait utiliser m4 pour structurer des programmes comme brainfuck.</p>
          </div>
          <div id="afterarticle">
              <div id="social">
                  <a href="/rss.xml" target="_blank" rel="noopener noreferrer nofollow" class="social">RSS</a>
                  ·
                  <a href="https://twitter.com/home?status=http%3A%2F%2Fyannesposito.com/Scratch/fr/blog/SVG-and-m4-fractals/%20via%20@yogsototh" target="_blank" rel="noopener noreferrer nofollow" class="social">Tweet</a>
                  ·
                  <a href="http://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fyannesposito.com/Scratch/fr/blog/SVG-and-m4-fractals/" target="_blank" rel="noopener noreferrer nofollow" class="social">FB</a>
                  <br />
                  <a class="message" href="../../../../Scratch/fr/blog/Social-link-the-right-way/">Ces liens sociaux préservent votre vie privée</a>
              </div>
              <div id="navigation">
                  <a href="../../../../">Accueil</a>
                  <span class="sep">¦</span>
                  <a href="../../../../Scratch/fr/blog">Blog</a>
                  <span class="sep">¦</span>
                  <a href="../../../../Scratch/fr/softwares">Logiciels</a>
                  <span class="sep">¦</span>
                  <a href="../../../../Scratch/fr/about">Auteur</a>
              </div>
              <div id="totop"><a href="#header">↑ Top ↑</a></div>
              <div id="bottom">
                  <div>
                      Published on 2011-10-20
                  </div>
                  <div>
                      <a href="https://twitter.com/yogsototh">Follow @yogsototh</a>
                  </div>
                  <div>
                      <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Yann Esposito©</a>
                  </div>

                  <div>
                      Done with
                      <a href="http://www.vim.org" target="_blank" rel="noopener noreferrer nofollow"><strike>Vim</strike></a>
                      <a href="http://spacemacs.org" target="_blank" rel="noopener noreferrer nofollow">spacemacs</a>
                      <span class="pala">&amp;</span>
                      <a href="http://nanoc.ws" target="_blank" rel="noopener noreferrer nofollow"><strike>nanoc</strike></a>
                      <a href="http://jaspervdj.be/hakyll" target="_blank" rel="noopener noreferrer nofollow">Hakyll</a>
                  </div>
                  <hr />
                  <div style="max-width: 100%">
                      <a href="https://cardanohub.org">
                          <img src="../../../../Scratch/img/ada-logo.png" class="simple" style="height: 16px;
                                    border-radius: 50%;
                                    vertical-align:middle;
                                    display:inline-block;" />
                          ADA:
                      </a>
                          <code style="display:inline-block;
                                       word-wrap:break-word;
                                       text-align: left;
                                       vertical-align: top;
                                       max-width: 85%;">
                              DdzFFzCqrhtAvdkmATx5Fm8NPJViDy85ZBw13p4XcNzVzvQg8e3vWLXq23JQWFxPEXK6Kvhaxxe7oJt4VMYHxpA2vtCFiP8fziohN6Yp
                          </code>
                  </div>
              </div>
          </div>
      </div>

        </div>
    </body>
</html>
