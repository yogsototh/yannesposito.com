<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Are Services superior to Free Monads?</title><meta name=author content="Yann Esposito"><meta name=description content="Here is a simple description on how to architect a big functional programming application."><meta name=keywords content="haskell clojure architecture programming"><link rel=stylesheet href=/css/y.css><link rel=alternate type=application/rss+xml href=/rss.xml><link rel=icon href=/favicon.ico><div id=labels><div class=al><span id=logo><a href=/><svg width="5em" viewBox="0 0 64 64"><circle cx="32" cy="32" r="30" stroke="var(--b2)" stroke-width="2" fill="var(--b03)"/><circle cx="32" cy="32" r="12" stroke="var(--r)" stroke-width="2" fill="var(--o)"/><circle cx="32" cy="32" r="6" stroke-width="0" fill="var(--y)"/><ellipse cx="32" cy="14" rx="14" ry="8" stroke-width="0" fill="var(--b3)"/></svg></a></span></div></div><div class=cd><div id=preamble class=ar><div class=al><h1>Are Services superior to Free Monads?</h1><div class=cb><span class=yyydate>[2021-01-10 Sun]</span> on
<a href=https://her.esy.fun><span class=bd>Yann Esposito</span>'s blog</a></div><div class=ac>Here is a simple description on how to architect a big functional programming application.</div></div></div><div id=content><div class=ac><p>TODO</div><p>A recurring hot topic in the functional programming world is how to make your code scale while keeping professionnal level of code quality.<p>Quite often in the functional programming we communities and talk people are focusing on enhancing specifics…<p>To organise your code in a functional paradigm there are many concurrent proposals. And structuring a code application is challenging. The way you need to structure the code generally need to reach a few properties.<ol><li>You should make it easy to test your code<li>You need to support modern features any modern application is expected to provide. Typically ability to write logs, if possible send structured logs events.<li>The code should try to help people focalise on the business logic and put aside irrelevant technical details.<li>Split your applications into smaller (ideal composable) components<li>Control accesses between different components of your applications</ol><p>The design space is quite open. In Haskell for example, there are different proposed solutions.<p>One of my preferred one to start with is the Handler Pattern<a href=#fn1 class=h id=fnref1 role=doc-noteref><sup>1</sup></a>. Because it doesn't need any advanced Haskell knowledge to understand. And also it prevents a classical overabstraction haskell curse I often see within Haskellers. No premature abstraction here. No typeclass.<p>The main principle behing it is that you create <em>handlers</em>. Handlers are <em>component</em> focused that each provide a set of methods and functions already initialized.<h1 id=monads--mtl--rio--handler-pattern--free-monad>Monads, MTL, RIO, Handler Pattern, Free Monad</h1><p>There are a lot of solutions to architecture a program while keeping all the best properties of functional programming as well as best professional practices.<p>Here too, there are different level of looking at the problem of code organisation. On the very high level, an application is often understood as a set of features. But for all of thoses features to work together it is generally a lot of work to organise them.<p>So we can descend the level to look at code organisation. Files organisation, how to group them. Structure of the code organisation. How to put test, etc…<p>If you strive for composability you generally try to understand how to group "components" and ask yourselve what a componentn should contain. Here is a solution.<h1 id=free-monads-effect-system>Free Monads/Effect System</h1><p>Foreword, semantic vs syntax.<p>The kind of best way to talk about semantic and forget about the syntax is to deal directly with a simplified representation of the AST.<p>Overall API:<div class=n id=cb2><pre class="n clojure"><code class="n clojure"><span id=cb2-1><a href=#cb2-1 aria-hidden=true tabindex=-1></a>(interpret-with</span>
<span id=cb2-2><a href=#cb2-2 aria-hidden=true tabindex=-1></a> [effect<span class=dv>-1</span> effect<span class=dv>-2</span> ... effect-n]</span>
<span id=cb2-3><a href=#cb2-3 aria-hidden=true tabindex=-1></a> (<span class=kw>let</span> [admin-user (get-in-config [<span class=at>:user</span> <span class=at>:admin</span> <span class=at>:user-id</span>])</span>
<span id=cb2-4><a href=#cb2-4 aria-hidden=true tabindex=-1></a>       admin (get-user admin-user-id)</span>
<span id=cb2-5><a href=#cb2-5 aria-hidden=true tabindex=-1></a>       admin-email (<span class=kw>get</span> admin <span class=at>:email</span>)]</span>
<span id=cb2-6><a href=#cb2-6 aria-hidden=true tabindex=-1></a>   (log <span class=st>&quot;Admin email&quot;</span> admin-email)</span>
<span id=cb2-7><a href=#cb2-7 aria-hidden=true tabindex=-1></a>   admin-email))</span></code></pre></div><p>It will be up to the actual instanciation of all <code class=w>effect-*</code> to change the interpretation of the body. So some effect could have different interpreation of specific symbols. So here we can imagine that <code class=w>get-in-config</code>, <code class=w>get-user</code> and <code class=w>log</code> are handlers specified in the effects.<p>One advantage is that to test your code you can simply use stubbed effects. One can use a list users<p>Real effects and free monads are in fact more powerful than this example is showing. For example, within a free monad, even <code class=w>let</code> semantic would be changed. But let's not take this rabbit hole in this article right now.<section class=u role=doc-endnotes><hr><ol><li id=fn1 role=doc-endnote><pre class=example><code>https://jaspervdj.be/posts/2018-03-08-handle-pattern.html
</code></pre><a href=#fnref1 class=d role=doc-backlink>↩︎</a></ol></section></div><div id=postamble class=ar><div class=al><nav><a href=/index.html>Home</a> |
<a href=/slides.html>Slides</a> |
<a href=/about-me.html>About</a>
<span class=aj>(<a href=https://gitea.esy.fun/yogsototh>code</a>
<a href=https://espial.esy.fun/u:yogsototh>bookmarks</a>
<a href=https://espial.esy.fun/u:yogsototh/notes>notes</a>)</span> |
<a href=#preamble>↑ Top ↑</a></nav></div></div></div>