<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Add links to code block during orgmode export</title><meta name=author content="Yann Esposito"><meta name=description content="Add links to code block during orgmode export."><meta name=keywords content="org-mode blog"><link rel=stylesheet href=/css/y.css><link rel=alternate type=application/rss+xml href=/rss.xml><link rel=icon href=/favicon.ico><div class=main><div id=preamble class=status><div class=content><div id=logo><a href=/><svg width="5em" viewBox="0 0 64 64"><circle cx="32" cy="32" r="30" stroke="var(--b2)" stroke-width="2" fill="var(--b03)"/><circle cx="32" cy="32" r="12" stroke="var(--r)" stroke-width="2" fill="var(--o)"/><circle cx="32" cy="32" r="6" stroke-width="0" fill="var(--y)"/><ellipse cx="32" cy="14" rx="14" ry="8" stroke-width="0" fill="var(--b3)"/></svg></a></div><h1>Add links to code block during orgmode export</h1><div class=meta><span class=yyydate>[2020-02-29 Sat]</span> on
<a href=https://her.esy.fun><span class=author>Yann Esposito</span>'s blog</a></div><div class=abstract>Add links to code block during orgmode export.</div></div></div><div id=content><p>I wanted to add a link to the file I export with org tangle. And it was surprisingly difficult to find. Apparently I am one of the few people that use orgmode the way I do.<p>Using orgmode file as markdown to blog. And exporting to a different file some code block. So I often endup writing something like:<pre class=org><code>..begin_src elisp :tangle foo.el
</code></pre><p>I tangle the source code that export the code block to an external file. Then I use this hook during HTML export to add a caption with the link the file I tangled:<pre class=elisp data-tangle=org_html_export_show_tangle.el><code>(defun my-add-link-to-tangled-files (backend)
  &quot;Add a link just before source code block with tangled files.
BACKEND is the export backend. Used as symbol.&quot;
  (while ;; (re-search-forward )
      (re-search-forward &quot;^\\( *\\)#\\+begin_src .*:tangle \\([^\s\n]*\\)&quot; nil t)
    (replace-match &quot;\\1#+CAPTION: [[./\\2][=\\2=]]\n\\&amp;&quot;)))

(add-hook &#39;org-export-before-processing-hook
          &#39;my-add-link-to-tangled-files)
</code></pre><p>And this article is an example of the result. The link with the listing is generated automatically for me.<p>A small note regarding CSS. My <code>pre</code> have a <code>margin-top</code>. But I wanted to get rid of it when the previous block was a <code>label</code>. This is achievable with:<div class=sourceCode id=cb3><pre class="sourceCode css"><code class="sourceCode css"><span id=cb3-1><a href=#cb3-1 aria-hidden=true></a>label <span class=op>+</span> pre {<span class=kw>margin-top</span>: <span class=dv>0</span><span class=op>;</span>}</span></code></pre></div><p>That's it. It took me really a long time to just think about using caption, and not trying something smarter like injecting html code, etc… So I hope it could help someone.</div><div id=postamble class=status><div class=content><nav><a href=/index.html>Home</a> |
<a href=/slides.html>Slides</a> |
<a href=/about-me.html>About</a>
<span class=details>(<a href=https://gitea.esy.fun/yogsototh>code</a>
<a href=https://espial.esy.fun/u:yogsototh>bookmarks</a>
<a href=https://espial.esy.fun/u:yogsototh/notes>notes</a>)</span> |
<a href=#preamble>↑ Top ↑</a></nav></div></div></div>