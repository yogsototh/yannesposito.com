<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>RSS Generation</title><meta name=author content="Yann Esposito"><meta name=description content="How I generate RSS feed via command line"><meta name=keywords content="programming web"><link rel=stylesheet href=/css/y.css><link rel=alternate type=application/rss+xml href=/rss.xml><link rel=icon href=/favicon.ico><div class=main><div id=logo><a href=/><svg width="5em" viewBox="0 0 64 64"><circle cx="32" cy="32" r="30" stroke="#a3aec2" stroke-width="1" fill="#2e3440"/><circle cx="32" cy="32" r="12" stroke="#800" stroke-width="1" fill="#c20"/><circle cx="32" cy="32" r="5" stroke-width="1" stroke="#f60" fill="#fa0"/><ellipse cx="32" cy="14" rx="14" ry="8" stroke-width="0" fill="#fff"/></svg></a></div><div id=preamble class=status><div class=content><h1>RSS Generation</h1><div class=meta><span class=yyydate>[2019-09-30 Mon]</span> on
<a href=https://her.esy.fun><span class=author>Yann Esposito</span>'s blog</a></div><div class=abstract>How I generate RSS feed via command line</div></div></div><div id=content><div class=notes><p>TL;DR: To generate an RSS file you need to provide many metadatas. Those metadata are not part of all HTML files. So generating RSS from a tree of HTML file is not straightforward. Here is the script I use.</div><h1 id=rss-problem>RSS Problem</h1><p>RSS feed is meant to declare updates and new articles for a website. Each RSS entry must therefore have a date, an unique id, a title, maybe some categories, etc…<p>For most blog platform or even static website generator, those meta infos are clearly put in the sources or in some DB.<p>I use <code>org-mode</code> for generating my website, and the <code>ox-rss</code> is quite slow when generating an RSS with the full content of each item. Mainly, the way to achieve full content of my articles inside an RSS with <code>ox-rss</code> is by first creating a very big org file containing all the articles, and then transforming it in RSS. And this is very slow (several minutes).<p>So a simpler idea inspired by lb<a href=#fn1 class=footnote-ref id=fnref1 role=doc-noteref><sup>1</sup></a> is to generate the RSS directly from the generated HTML files. The only difficulty is to find the metadata inside those HTML. Unfortunately there is no real standard for all those metas.<p>So to use the HTML as source you'll need to "parse" the HTML file. For that purpose I use <code>html-xml-utils</code><a href=#fn2 class=footnote-ref id=fnref2 role=doc-noteref><sup>2</sup></a>.<p>I wrote a simple zsh script; it starts with lot of variables to fill:<div class=sourceCode id=cb1><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb1-1><a href=#cb1-1 aria-hidden=true></a><span class=co># Directory</span></span>
<span id=cb1-2><a href=#cb1-2 aria-hidden=true></a><span class=va>webdir=</span><span class=st>&quot;_site&quot;</span> # <span class=ex>directory</span> containing your website html files</span>
<span id=cb1-3><a href=#cb1-3 aria-hidden=true></a><span class=va>postsdir=</span><span class=st>&quot;</span><span class=va>$webdir</span><span class=st>/posts&quot;</span> # <span class=ex>directory</span> containing the articles</span>
<span id=cb1-4><a href=#cb1-4 aria-hidden=true></a><span class=va>rssfile=</span><span class=st>&quot;</span><span class=va>$webdir</span><span class=st>/rss.xml&quot;</span> # <span class=ex>the</span> RSS file to generate</span>
<span id=cb1-5><a href=#cb1-5 aria-hidden=true></a></span>
<span id=cb1-6><a href=#cb1-6 aria-hidden=true></a><span class=co># maximal number of articles to put in the RSS file</span></span>
<span id=cb1-7><a href=#cb1-7 aria-hidden=true></a><span class=va>maxarticles=</span>10</span>
<span id=cb1-8><a href=#cb1-8 aria-hidden=true></a></span>
<span id=cb1-9><a href=#cb1-9 aria-hidden=true></a><span class=co># RSS Metas</span></span>
<span id=cb1-10><a href=#cb1-10 aria-hidden=true></a><span class=va>rsstitle=</span><span class=st>&quot;her.esy.fun&quot;</span></span>
<span id=cb1-11><a href=#cb1-11 aria-hidden=true></a><span class=va>rssurl=</span><span class=st>&quot;https://her.esy.fun/rss.xml&quot;</span></span>
<span id=cb1-12><a href=#cb1-12 aria-hidden=true></a><span class=va>websiteurl=</span><span class=st>&quot;https://her.esy.fun&quot;</span></span>
<span id=cb1-13><a href=#cb1-13 aria-hidden=true></a><span class=va>rssdescription=</span><span class=st>&quot;her.esy.fun articles, mostly random personal thoughts&quot;</span></span>
<span id=cb1-14><a href=#cb1-14 aria-hidden=true></a><span class=va>rsslang=</span><span class=st>&quot;en&quot;</span></span>
<span id=cb1-15><a href=#cb1-15 aria-hidden=true></a><span class=va>rssauthor=</span><span class=st>&quot;yann@esposito.host (Yann Esposito)&quot;</span></span>
<span id=cb1-16><a href=#cb1-16 aria-hidden=true></a><span class=va>rssimgtitle=</span><span class=st>&quot;yogsototh&quot;</span></span>
<span id=cb1-17><a href=#cb1-17 aria-hidden=true></a><span class=va>rssimgurl=</span><span class=st>&quot;https://her.esy.fun/img/FlatAvatar.png&quot;</span></span></code></pre></div><p>Then I set the accessor to extract the information I want from HTML files. It is quite unfortunate that there is no really strong convention for where to put article dates, article author email. There are metas for title and keywords thought.<div class=sourceCode id=cb2><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb2-1><a href=#cb2-1 aria-hidden=true></a><span class=co># HTML Accessors (similar to CSS accessors)</span></span>
<span id=cb2-2><a href=#cb2-2 aria-hidden=true></a><span class=va>dateaccessor=</span><span class=st>&#39;.article-date&#39;</span></span>
<span id=cb2-3><a href=#cb2-3 aria-hidden=true></a><span class=va>contentaccessor=</span><span class=st>&#39;#content&#39;</span></span>
<span id=cb2-4><a href=#cb2-4 aria-hidden=true></a><span class=co># title and keyword shouldn&#39;t be changed</span></span>
<span id=cb2-5><a href=#cb2-5 aria-hidden=true></a><span class=va>titleaccessor=</span><span class=st>&#39;title&#39;</span></span>
<span id=cb2-6><a href=#cb2-6 aria-hidden=true></a><span class=va>keywordsaccessor=</span><span class=st>&#39;meta[name=keywords]::attr(content)&#39;</span></span></code></pre></div><p>A few helper functions:<div class=sourceCode id=cb3><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb3-1><a href=#cb3-1 aria-hidden=true></a><span class=fu>formatdate()</span> <span class=kw>{</span></span>
<span id=cb3-2><a href=#cb3-2 aria-hidden=true></a>    <span class=co># format the date for RSS</span></span>
<span id=cb3-3><a href=#cb3-3 aria-hidden=true></a>    <span class=bu>local</span> <span class=va>d=$1</span></span>
<span id=cb3-4><a href=#cb3-4 aria-hidden=true></a>    <span class=va>LC_TIME=</span>en_US <span class=fu>date</span> --date <span class=va>$d</span> +<span class=st>&#39;%a, %d %b %Y %H:%M:%S %z&#39;</span></span>
<span id=cb3-5><a href=#cb3-5 aria-hidden=true></a><span class=kw>}</span></span>
<span id=cb3-6><a href=#cb3-6 aria-hidden=true></a></span>
<span id=cb3-7><a href=#cb3-7 aria-hidden=true></a><span class=fu>finddate()</span><span class=kw>{</span> <span class=op>&lt;</span> <span class=va>$1</span> <span class=ex>hxselect</span> -c <span class=va>$dateaccessor</span> <span class=kw>}</span></span>
<span id=cb3-8><a href=#cb3-8 aria-hidden=true></a><span class=fu>findtitle()</span><span class=kw>{</span> <span class=op>&lt;</span> <span class=va>$1</span> <span class=ex>hxselect</span> -c <span class=va>$titleaccessor</span> <span class=kw>}</span></span>
<span id=cb3-9><a href=#cb3-9 aria-hidden=true></a><span class=co># retrieve the content, take care of using absolute URL</span></span>
<span id=cb3-10><a href=#cb3-10 aria-hidden=true></a><span class=fu>getcontent()</span><span class=kw>{</span></span>
<span id=cb3-11><a href=#cb3-11 aria-hidden=true></a>    <span class=op>&lt;</span> <span class=va>$1</span> <span class=ex>hxselect</span> <span class=va>$contentaccessor</span> <span class=kw>|</span> <span class=kw>\</span></span>
<span id=cb3-12><a href=#cb3-12 aria-hidden=true></a>                  <span class=fu>perl</span> -pe <span class=st>&#39;use URI; $base=&quot;&#39;</span><span class=va>$2</span><span class=st>&#39;&quot;; s# (href|src)=&quot;((?!https?://)[^&quot;]*)&quot;#&quot; &quot;.$1.&quot;=\&quot;&quot;.URI-&gt;new_abs($2,$base)-&gt;as_string.&quot;\&quot;&quot;#eig&#39;</span> <span class=kw>}</span></span>
<span id=cb3-13><a href=#cb3-13 aria-hidden=true></a><span class=fu>findkeywords()</span><span class=kw>{</span> <span class=op>&lt;</span> <span class=va>$1</span> <span class=ex>hxselect</span> -c <span class=va>$keywordsaccessor</span> <span class=kw>|</span> <span class=fu>sed</span> <span class=st>&#39;s/,//g&#39;</span> <span class=kw>}</span></span>
<span id=cb3-14><a href=#cb3-14 aria-hidden=true></a><span class=fu>mkcategories()</span><span class=kw>{</span></span>
<span id=cb3-15><a href=#cb3-15 aria-hidden=true></a>    <span class=kw>for</span> <span class=ex>keyword</span> in <span class=va>$*</span><span class=kw>;</span> <span class=kw>do</span></span>
<span id=cb3-16><a href=#cb3-16 aria-hidden=true></a>        <span class=bu>printf</span> <span class=st>&quot;</span><span class=dt>\\</span><span class=st>n&lt;category&gt;%s&lt;/category&gt;&quot;</span> <span class=va>$keyword</span></span>
<span id=cb3-17><a href=#cb3-17 aria-hidden=true></a>    <span class=kw>done</span></span>
<span id=cb3-18><a href=#cb3-18 aria-hidden=true></a><span class=kw>}</span></span></code></pre></div><p>The <code>mkcategories</code> will be used to add an RSS category for each keyword. And finally the real loop doing the work:<div class=sourceCode id=cb4><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb4-1><a href=#cb4-1 aria-hidden=true></a><span class=va>tmpdir=$(</span><span class=fu>mktemp</span> -d<span class=va>)</span> # <span class=ex>create</span> a temporary work dir</span>
<span id=cb4-2><a href=#cb4-2 aria-hidden=true></a><span class=bu>typeset</span> -a <span class=va>dates</span>    # <span class=va>an</span> <span class=va>array</span> <span class=va>to</span> <span class=va>save</span> <span class=va>dates</span> <span class=va>of</span> <span class=va>all</span> <span class=va>articles</span></span>
<span id=cb4-3><a href=#cb4-3 aria-hidden=true></a><span class=va>dates=(</span> <span class=va>)</span></span>
<span id=cb4-4><a href=#cb4-4 aria-hidden=true></a></span>
<span id=cb4-5><a href=#cb4-5 aria-hidden=true></a><span class=co># for each HTML file we generate the XML for the item in a file</span></span>
<span id=cb4-6><a href=#cb4-6 aria-hidden=true></a><span class=co># named ${d}-$(basename $fic).rss that naming convention will be useful to</span></span>
<span id=cb4-7><a href=#cb4-7 aria-hidden=true></a><span class=co># sort article by date</span></span>
<span id=cb4-8><a href=#cb4-8 aria-hidden=true></a><span class=kw>for</span> <span class=ex>fic</span> in <span class=va>$postsdir</span>/**/*.html<span class=kw>;</span> <span class=kw>do</span></span>
<span id=cb4-9><a href=#cb4-9 aria-hidden=true></a>    <span class=va>postfile=</span><span class=st>&quot;</span><span class=va>$(</span><span class=bu>echo</span> <span class=st>&quot;</span><span class=va>$fic</span><span class=st>&quot;</span><span class=kw>|</span><span class=fu>sed</span> <span class=st>&#39;s#^&#39;</span><span class=va>$postsdir</span><span class=st>&#39;/##&#39;</span><span class=va>)</span><span class=st>&quot;</span></span>
<span id=cb4-10><a href=#cb4-10 aria-hidden=true></a>    <span class=va>blogfile=</span><span class=st>&quot;</span><span class=va>$(</span><span class=bu>echo</span> <span class=st>&quot;</span><span class=va>$fic</span><span class=st>&quot;</span><span class=kw>|</span><span class=fu>sed</span> <span class=st>&#39;s#^&#39;</span><span class=va>$webdir</span><span class=st>&#39;/##&#39;</span><span class=va>)</span><span class=st>&quot;</span></span>
<span id=cb4-11><a href=#cb4-11 aria-hidden=true></a>    <span class=bu>printf</span> <span class=st>&quot;%-30s&quot;</span> <span class=va>$postfile</span></span>
<span id=cb4-12><a href=#cb4-12 aria-hidden=true></a>    <span class=va>xfic=</span><span class=st>&quot;</span><span class=va>$tmpdir</span><span class=st>/</span><span class=va>$fic</span><span class=st>.xml&quot;</span></span>
<span id=cb4-13><a href=#cb4-13 aria-hidden=true></a>    <span class=fu>mkdir</span> -p <span class=va>$(</span><span class=fu>dirname</span> <span class=va>$xfic)</span></span>
<span id=cb4-14><a href=#cb4-14 aria-hidden=true></a>    <span class=ex>hxclean</span> <span class=va>$fic</span> <span class=op>&gt;</span> <span class=va>$xfic</span> # create a cleaner HTML file to help hxselect work</span>
<span id=cb4-15><a href=#cb4-15 aria-hidden=true></a>    <span class=va>d=$(</span><span class=ex>finddate</span> <span class=va>$xfic)</span></span>
<span id=cb4-16><a href=#cb4-16 aria-hidden=true></a>    <span class=bu>echo</span> -n <span class=st>&quot; [</span><span class=va>$d</span><span class=st>]&quot;</span></span>
<span id=cb4-17><a href=#cb4-17 aria-hidden=true></a>    <span class=va>rssdate=$(</span><span class=ex>formatdate</span> <span class=va>$d)</span></span>
<span id=cb4-18><a href=#cb4-18 aria-hidden=true></a>    <span class=va>title=$(</span><span class=ex>findtitle</span> <span class=va>$xfic)</span></span>
<span id=cb4-19><a href=#cb4-19 aria-hidden=true></a>    <span class=va>keywords=(</span> <span class=va>$(</span><span class=ex>findkeywords</span> <span class=va>$xfic)</span> <span class=va>)</span></span>
<span id=cb4-20><a href=#cb4-20 aria-hidden=true></a>    <span class=bu>printf</span> <span class=st>&quot;: %-55s&quot;</span> <span class=st>&quot;</span><span class=va>$title</span><span class=st> (</span><span class=va>$keywords</span><span class=st>)&quot;</span></span>
<span id=cb4-21><a href=#cb4-21 aria-hidden=true></a>    <span class=co># up until here, we extracted the informations we need for the item</span></span>
<span id=cb4-22><a href=#cb4-22 aria-hidden=true></a>    <span class=va>categories=$(</span><span class=ex>mkcategories</span> <span class=va>$keywords)</span></span>
<span id=cb4-23><a href=#cb4-23 aria-hidden=true></a>    <span class=va>absoluteurl=</span><span class=st>&quot;</span><span class=va>${websiteurl}</span><span class=st>/</span><span class=va>${blogfile}</span><span class=st>&quot;</span></span>
<span id=cb4-24><a href=#cb4-24 aria-hidden=true></a>    <span class=kw>{</span> <span class=bu>printf</span> <span class=st>&quot;</span><span class=dt>\\</span><span class=st>n&lt;item&gt;&quot;</span></span>
<span id=cb4-25><a href=#cb4-25 aria-hidden=true></a>      <span class=bu>printf</span> <span class=st>&quot;</span><span class=dt>\\</span><span class=st>n&lt;title&gt;%s&lt;/title&gt;&quot;</span> <span class=st>&quot;</span><span class=va>$title</span><span class=st>&quot;</span></span>
<span id=cb4-26><a href=#cb4-26 aria-hidden=true></a>      <span class=bu>printf</span> <span class=st>&quot;</span><span class=dt>\\</span><span class=st>n&lt;guid&gt;%s&lt;/guid&gt;&quot;</span> <span class=st>&quot;</span><span class=va>$absoluteurl</span><span class=st>&quot;</span></span>
<span id=cb4-27><a href=#cb4-27 aria-hidden=true></a>      <span class=bu>printf</span> <span class=st>&quot;</span><span class=dt>\\</span><span class=st>n&lt;pubDate&gt;%s&lt;/pubDate&gt;%s&quot;</span> <span class=st>&quot;</span><span class=va>$rssdate</span><span class=st>&quot;</span></span>
<span id=cb4-28><a href=#cb4-28 aria-hidden=true></a>      <span class=bu>printf</span> <span class=st>&quot;%s&quot;</span> <span class=st>&quot;</span><span class=va>$categories</span><span class=st>&quot;</span></span>
<span id=cb4-29><a href=#cb4-29 aria-hidden=true></a>      <span class=bu>printf</span> <span class=st>&quot;</span><span class=dt>\\</span><span class=st>n&lt;description&gt;&lt;![CDATA[</span><span class=dt>\\</span><span class=st>n%s</span><span class=dt>\\</span><span class=st>n]]&gt;&lt;/description&gt;&quot;</span> <span class=st>&quot;</span><span class=va>$(</span><span class=ex>getcontent</span> <span class=st>&quot;</span><span class=va>$xfic</span><span class=st>&quot;</span> <span class=st>&quot;</span><span class=va>$absoluteurl</span><span class=st>&quot;</span><span class=va>)</span><span class=st>&quot;</span></span>
<span id=cb4-30><a href=#cb4-30 aria-hidden=true></a>      <span class=bu>printf</span> <span class=st>&quot;</span><span class=dt>\\</span><span class=st>n&lt;/item&gt;</span><span class=dt>\\</span><span class=st>n</span><span class=dt>\\</span><span class=st>n&quot;</span></span>
<span id=cb4-31><a href=#cb4-31 aria-hidden=true></a>    <span class=kw>}</span> <span class=op>&gt;&gt;</span>  <span class=st>&quot;</span><span class=va>$tmpdir</span><span class=st>/</span><span class=va>${d}</span><span class=st>-</span><span class=va>$(</span><span class=fu>basename</span> <span class=va>$fic)</span><span class=st>.rss&quot;</span></span>
<span id=cb4-32><a href=#cb4-32 aria-hidden=true></a>    <span class=co># we append the date to the list of dates</span></span>
<span id=cb4-33><a href=#cb4-33 aria-hidden=true></a>    <span class=va>dates=(</span> <span class=va>$d</span> <span class=va>$dates</span> <span class=va>)</span></span>
<span id=cb4-34><a href=#cb4-34 aria-hidden=true></a>    <span class=bu>echo</span> <span class=st>&quot; [</span><span class=va>${fg[green]}</span><span class=st>OK</span><span class=va>${reset_color}</span><span class=st>]&quot;</span></span>
<span id=cb4-35><a href=#cb4-35 aria-hidden=true></a><span class=kw>done</span></span>
<span id=cb4-36><a href=#cb4-36 aria-hidden=true></a></span>
<span id=cb4-37><a href=#cb4-37 aria-hidden=true></a><span class=co># Now we publish the items in reverse newer articles first</span></span>
<span id=cb4-38><a href=#cb4-38 aria-hidden=true></a><span class=bu>echo</span> <span class=st>&quot;Publishing&quot;</span></span>
<span id=cb4-39><a href=#cb4-39 aria-hidden=true></a><span class=kw>for</span> <span class=ex>fic</span> in <span class=va>$(</span><span class=fu>ls</span> <span class=va>$tmpdir</span>/*.rss <span class=kw>|</span> <span class=fu>sort</span> -r <span class=kw>|</span> <span class=fu>head</span> -n <span class=va>$maxarticles</span> <span class=va>)</span><span class=kw>;</span> <span class=kw>do</span></span>
<span id=cb4-40><a href=#cb4-40 aria-hidden=true></a>    <span class=bu>echo</span> <span class=st>&quot;</span><span class=va>${fic:t}</span><span class=st>&quot;</span></span>
<span id=cb4-41><a href=#cb4-41 aria-hidden=true></a>    <span class=fu>cat</span> <span class=va>$fic</span> <span class=op>&gt;&gt;</span> <span class=va>$tmpdir</span>/rss</span>
<span id=cb4-42><a href=#cb4-42 aria-hidden=true></a><span class=kw>done</span></span>
<span id=cb4-43><a href=#cb4-43 aria-hidden=true></a></span>
<span id=cb4-44><a href=#cb4-44 aria-hidden=true></a><span class=co># we get the latest publish date</span></span>
<span id=cb4-45><a href=#cb4-45 aria-hidden=true></a><span class=va>rssmaxdate=$(</span><span class=ex>formatdate</span> <span class=va>$(</span><span class=kw>for</span> <span class=ex>d</span> in <span class=va>$dates</span><span class=kw>;</span> <span class=kw>do</span> <span class=bu>echo</span> <span class=va>$d</span><span class=kw>;</span> <span class=kw>done</span> <span class=kw>|</span> <span class=fu>sort</span> -r <span class=kw>|</span> <span class=fu>head</span> -n 1<span class=va>))</span></span>
<span id=cb4-46><a href=#cb4-46 aria-hidden=true></a><span class=co># we put the current date for the latest build date</span></span>
<span id=cb4-47><a href=#cb4-47 aria-hidden=true></a><span class=va>rssbuilddate=$(</span><span class=ex>formatdate</span> <span class=va>$(</span><span class=fu>date</span><span class=va>))</span></span>
<span id=cb4-48><a href=#cb4-48 aria-hidden=true></a></span>
<span id=cb4-49><a href=#cb4-49 aria-hidden=true></a><span class=co># we generate the RSS file</span></span>
<span id=cb4-50><a href=#cb4-50 aria-hidden=true></a><span class=kw>{</span></span>
<span id=cb4-51><a href=#cb4-51 aria-hidden=true></a><span class=co># Write the preamble of the RSS file</span></span>
<span id=cb4-52><a href=#cb4-52 aria-hidden=true></a><span class=fu>cat</span> <span class=op>&lt;&lt;END</span></span>
<span id=cb4-53><a href=#cb4-53 aria-hidden=true></a>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span id=cb4-54><a href=#cb4-54 aria-hidden=true></a>&lt;rss version=&quot;2.0&quot;</span>
<span id=cb4-55><a href=#cb4-55 aria-hidden=true></a>       xmlns:content=&quot;http://purl.org/rss/1.0/modules/content/&quot;</span>
<span id=cb4-56><a href=#cb4-56 aria-hidden=true></a>       xmlns:wfw=&quot;http://wellformedweb.org/CommentAPI/&quot;</span>
<span id=cb4-57><a href=#cb4-57 aria-hidden=true></a>       xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot;</span>
<span id=cb4-58><a href=#cb4-58 aria-hidden=true></a>       xmlns:atom=&quot;http://www.w3.org/2005/Atom&quot;</span>
<span id=cb4-59><a href=#cb4-59 aria-hidden=true></a>       xmlns:sy=&quot;http://purl.org/rss/1.0/modules/syndication/&quot;</span>
<span id=cb4-60><a href=#cb4-60 aria-hidden=true></a>       xmlns:slash=&quot;http://purl.org/rss/1.0/modules/slash/&quot;</span>
<span id=cb4-61><a href=#cb4-61 aria-hidden=true></a>       xmlns:georss=&quot;http://www.georss.org/georss&quot;</span>
<span id=cb4-62><a href=#cb4-62 aria-hidden=true></a>     xmlns:geo=&quot;http://www.w3.org/2003/01/geo/wgs84_pos#&quot;</span>
<span id=cb4-63><a href=#cb4-63 aria-hidden=true></a>     xmlns:media=&quot;http://search.yahoo.com/mrss/&quot;&gt;&lt;channel&gt;</span>
<span id=cb4-64><a href=#cb4-64 aria-hidden=true></a>  &lt;title&gt;<span class=va>${rsstitle}</span>&lt;/title&gt;</span>
<span id=cb4-65><a href=#cb4-65 aria-hidden=true></a>  &lt;atom:link href=&quot;<span class=va>${rssurl}</span>&quot; rel=&quot;self&quot; type=&quot;application/rss+xml&quot; /&gt;</span>
<span id=cb4-66><a href=#cb4-66 aria-hidden=true></a>  &lt;link&gt;<span class=va>${websiteurl}</span>&lt;/link&gt;</span>
<span id=cb4-67><a href=#cb4-67 aria-hidden=true></a>  &lt;description&gt;&lt;![CDATA[<span class=va>${rssdescription}</span>]]&gt;&lt;/description&gt;</span>
<span id=cb4-68><a href=#cb4-68 aria-hidden=true></a>  &lt;language&gt;<span class=va>${rsslang}</span>&lt;/language&gt;</span>
<span id=cb4-69><a href=#cb4-69 aria-hidden=true></a>  &lt;pubDate&gt;<span class=va>${rssmaxdate}</span>&lt;/pubDate&gt;</span>
<span id=cb4-70><a href=#cb4-70 aria-hidden=true></a>  &lt;lastBuildDate&gt;<span class=va>$rssbuilddate</span>&lt;/lastBuildDate&gt;</span>
<span id=cb4-71><a href=#cb4-71 aria-hidden=true></a>  &lt;generator&gt;mkrss.sh&lt;/generator&gt;</span>
<span id=cb4-72><a href=#cb4-72 aria-hidden=true></a>  &lt;webMaster&gt;<span class=va>${rssauthor}</span>&lt;/webMaster&gt;</span>
<span id=cb4-73><a href=#cb4-73 aria-hidden=true></a>  &lt;image&gt;</span>
<span id=cb4-74><a href=#cb4-74 aria-hidden=true></a>    &lt;url&gt;<span class=va>${rssimgurl}</span>&lt;/url&gt;</span>
<span id=cb4-75><a href=#cb4-75 aria-hidden=true></a>    &lt;title&gt;<span class=va>${rssimgtitle}</span>&lt;/title&gt;</span>
<span id=cb4-76><a href=#cb4-76 aria-hidden=true></a>    &lt;link&gt;<span class=va>${websiteurl}</span>&lt;/link&gt;</span>
<span id=cb4-77><a href=#cb4-77 aria-hidden=true></a>  &lt;/image&gt;</span>
<span id=cb4-78><a href=#cb4-78 aria-hidden=true></a><span class=op>END</span></span>
<span id=cb4-79><a href=#cb4-79 aria-hidden=true></a></span>
<span id=cb4-80><a href=#cb4-80 aria-hidden=true></a><span class=co># write all items</span></span>
<span id=cb4-81><a href=#cb4-81 aria-hidden=true></a><span class=fu>cat</span> <span class=va>$tmpdir</span>/rss</span>
<span id=cb4-82><a href=#cb4-82 aria-hidden=true></a></span>
<span id=cb4-83><a href=#cb4-83 aria-hidden=true></a><span class=co># close the RSS file</span></span>
<span id=cb4-84><a href=#cb4-84 aria-hidden=true></a><span class=fu>cat</span> <span class=op>&lt;&lt;END</span></span>
<span id=cb4-85><a href=#cb4-85 aria-hidden=true></a>&lt;/channel&gt;</span>
<span id=cb4-86><a href=#cb4-86 aria-hidden=true></a>&lt;/rss&gt;</span>
<span id=cb4-87><a href=#cb4-87 aria-hidden=true></a><span class=op>END</span></span>
<span id=cb4-88><a href=#cb4-88 aria-hidden=true></a><span class=kw>}</span> <span class=op>&gt;</span> <span class=st>&quot;</span><span class=va>$rssfile</span><span class=st>&quot;</span></span>
<span id=cb4-89><a href=#cb4-89 aria-hidden=true></a></span>
<span id=cb4-90><a href=#cb4-90 aria-hidden=true></a><span class=co># cleanup temporary directory</span></span>
<span id=cb4-91><a href=#cb4-91 aria-hidden=true></a><span class=fu>rm</span> -rf <span class=va>$tmpdir</span></span>
<span id=cb4-92><a href=#cb4-92 aria-hidden=true></a><span class=bu>echo</span> <span class=st>&quot;RSS Generated&quot;</span></span></code></pre></div><h2 id=full-script>Full script</h2><p>Here is the full script I use:<p><a href=mkrss.sh>mkrss.sh</a><p>You can notice I start my script with:<div class=sourceCode id=cb5><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb5-1><a href=#cb5-1 aria-hidden=true></a><span class=co>#!/usr/bin/env nix-shell</span></span>
<span id=cb5-2><a href=#cb5-2 aria-hidden=true></a><span class=co>#!nix-shell -i zsh</span></span></code></pre></div><p>The <code>nix-shell</code> bang pattern is a neat trick to have all the dependencies I need when running my script. It takes care that <code>zsh</code>, <code>coreutils</code> and <code>html-xml-utils</code> are installed before running my script. For example my script uses <code>date</code> from GNU coreutils and not the <code>BSD</code> date from my OS, which makes the script more portable. This also take care of using the URI perl package.<p>Along my script I have a <a href=rss-gen/shell.nix><code>shell.nix</code></a> file containing:<div class=sourceCode id=cb6><pre class="sourceCode nix"><code class="sourceCode bash"><span id=cb6-1><a href=#cb6-1 aria-hidden=true></a><span class=co># { pkgs ? import &lt;nixpkgs&gt; {} }:</span></span>
<span id=cb6-2><a href=#cb6-2 aria-hidden=true></a><span class=kw>{</span> <span class=ex>pkgs</span> ? import (fetchTarball https://github.com/NixOS/nixpkgs/archive/19.09.tar.gz) {<span class=kw>}</span> }:</span>
<span id=cb6-3><a href=#cb6-3 aria-hidden=true></a>  <span class=ex>pkgs.mkShell</span> {</span>
<span id=cb6-4><a href=#cb6-4 aria-hidden=true></a>    <span class=ex>buildInputs</span> = [ pkgs.coreutils pkgs.html-xml-utils pkgs.zsh pkgs.perl pkgs.perlPackages.URI ]<span class=kw>;</span></span>
<span id=cb6-5><a href=#cb6-5 aria-hidden=true></a>  }</span></code></pre></div><p>Mainly it <em>pins</em> a package version and the list in <code>buildInputs</code> contains the packages to install locally.<p>If you are not already using nix<a href=#fn3 class=footnote-ref id=fnref3 role=doc-noteref><sup>3</sup></a> you should really take a look. That <code>shell.nix</code> will work on Linux and MacOS.<section class=footnotes role=doc-endnotes><hr><ol><li id=fn1 role=doc-endnote><p><a href=https://github.com/LukeSmithxyz/lb>https://github.com/LukeSmithxyz/lb</a><a href=#fnref1 class=footnote-back role=doc-backlink>↩︎</a><li id=fn2 role=doc-endnote><p><a href=https://www.w3.org/Tools/HTML-XML-utils/>https://www.w3.org/Tools/HTML-XML-utils/</a><a href=#fnref2 class=footnote-back role=doc-backlink>↩︎</a><li id=fn3 role=doc-endnote><p><a href=https://nixos.org/nix>https://nixos.org/nix</a><a href=#fnref3 class=footnote-back role=doc-backlink>↩︎</a></ol></section></div><div id=postamble class=status><div class=content><nav><a href=/index.html>Home</a> |
<a href=/slides.html>Slides</a> |
<a href=/about-me.html>About</a>
<span class=details>(<a href=https://gitea.esy.fun/yogsototh>code</a>
<a href=https://espial.esy.fun/u:yogsototh>bookmarks</a>
<a href=https://espial.esy.fun/u:yogsototh/notes>notes</a>)</span> |
<a href=#logo>↑ Top ↑</a></nav></div></div></div>