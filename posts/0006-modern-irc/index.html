<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Modern IRC</title><meta name=author content="Yann Esposito"><meta name=description content="Why and how to have modern and respectful chat system with IRC."><meta name=keywords content="self-hosting chat irc"><link rel=stylesheet href=/css/y.css><link rel=alternate type=application/rss+xml href=/rss.xml><link rel=icon href=/favicon.ico><meta name=theme-color media="(prefers-color-scheme: light)" content="#d84100"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#2E3440"><div class=main><div id=logo><a href=/><div>Go to Home</div><svg width="5em" viewBox="0 0 64 64"><circle cx="32" cy="32" r="30" stroke="#a3aec2" stroke-width="1" fill="#2e3440"/><circle cx="32" cy="32" r="12" stroke="#800" stroke-width="1" fill="#c20"/><circle cx="32" cy="32" r="5" stroke-width="1" stroke="#f60" fill="#fa0"/><ellipse cx="32" cy="14" rx="14" ry="8" stroke-width="0" fill="#fff"/></svg></a></div><header id=preamble class=status role=banner><div class=content><h1>Modern IRC</h1><div class=meta><span class=yyydate>[2019-10-19 Sat]</span> on
<a href=https://her.esy.fun><span class=author>Yann Esposito</span>'s blog</a></div><div class=abstract>Why and how to have modern and respectful chat system with IRC.</div></div></header><main id=content role=main><nav id=toc role=doc-toc><ul><li><a href=#why-irc->Why IRC?</a><ul><li><a href=#about-failed-attempts--properties---custom-id--different-tries>About failed attempts</a></ul><li><a href=#tutorial>Tutorial</a><ul><li><a href=#self-host>Self Host</a><ul><li><a href=#create-a-reverse-proxy-with-nginx>Create a reverse proxy with nginx</a></ul><li><a href=#install-configure-ngircd>Install/configure ngircd</a><li><a href=#install-configure-znc>Install/configure ZNC</a><ul><li><a href=#playback-module>Playback module</a><li><a href=#palaver-push-module>Palaver push module</a><li><a href=#configure-your-irc-servers>Configure your IRC servers</a></ul><li><a href=#install-configure-clients>Install/configure clients</a><ul><li><a href=#weechat>weechat</a><li><a href=#thelounge>thelounge</a><li><a href=#palaver>Palaver</a></ul></ul><li><a href=#bonus>Bonus</a><ul><li><a href=#no-brainer-upload-file>No brainer upload file</a></ul></ul></nav><article><div class=notes><p>After reviewing and testing many different chat solutions the clear winner (at least for my taste) is IRC. More precisely via those softwares:<ul><li>IRC<li>ZNC (with playback and palaver module)<li>weechat with replay script (terminal client)<li>thelounge (web client)<li>Palaver (iOS client).</ul></div><h1 id=why-irc->Why IRC?</h1><p>How to chat in 2019? Certainly with slack, or via a social media app in the browser or mobile phone app.<p>How geeks should chat in 2019?<p>This post is about my opinion on the subject after having tried many different chat solutions<a href=#fn1 class=footnote-ref id=fnref1 role=doc-noteref><sup>1</sup></a>. Here is a list of the features I think a modern solution should have:<ol><li><strong>terminal client</strong> or <strong>terminal-like UI</strong> (in emacs for example). All modern UI looks cool for screenshots, but if you are going to use it a lot, you will prefer density over good looking. Most web apps are terrible when looking at delivered information by number of pixels ratio.<li><strong>multi-platform</strong>: If you do not have a terminal at hand (or emacs) then, you should be able to get your message on your phone or via a web interface for portability.<li><strong>self-hosted</strong>: you should control your data, your history, your logs, the encryption methods, etc…<li><strong>teams</strong> and <strong>direct messages</strong><li><strong>notifications</strong>, I tend to control those a lot, but a small private team chat is one of few exception where you generally want to be notified.<li><strong>Frugal</strong>. Really, we have a responsibility to do our best not to consume more resources than we really need. Chat should be about TEXT, not images, not videos, not presentations and PDF.<li><strong>No anti-features</strong>: show when someone is typing, show when someone as read your messages, etc… Those functionalities increase your social insecurities feeling. They forces you to answer sooner instead of really take the time to answer correctly. You can read Digitial minimalism to know more about that subject<a href=#fn2 class=footnote-ref id=fnref2 role=doc-noteref><sup>2</sup></a>.<li><strong>Free software</strong></ol><p>I am quite disappointed by <em>modern</em> chat applications.<p>Their major problems are:<ul><li><strong>resource-heavy</strong>; most those client applications (slack, gitter, riot, mattermost, etc…) easily consume more than 300MB of RAM. Most of the time those clients are electron applications.<li><strong>not private</strong>; most solution do not encrypt your conversations. Even if using encryption mechanism and you trust your client, and you will still reveal your social network topology.<li><strong>anti-minimalist</strong>; I want dense <em>text</em>. I do not want:<ul><li>emojis,<li>images,<li>animations (gif or videos),<li>HTML/Markdown display</ul><li><strong>manipulative</strong>; they try very hard to optimize engagement. This is generally achieved through FOMO<a href=#fn3 class=footnote-ref id=fnref3 role=doc-noteref><sup>3</sup></a> and social anxiety manipulations. A few examples:<ul><li>show when someone is writing a message<li>show when someone has read a message,<li>get notified about missed messages,<li>get a "top messages you missed",<li>etc…</ul><li><strong>Prepare to EEE<a href=#fn4 class=footnote-ref id=fnref4 role=doc-noteref><sup>4</sup></a></strong>: Most of those "modern" solution are all-in-one solutions. Server API + Clients with specific features. Doing it that way make it possible to provide specific features only via this "all in one" solution. If you want to use another client, or if they deprecate some (like slack did by removing their IRC bridge) then you will have no choice to use their entire closed ecosystem.</ul><h2 id=about-failed-attempts--properties---custom-id--different-tries>About failed attempts</h2><ul><li>Matrix: I've used Matrix, and in fact it was really good except; the server is written in python and is clearly not frugal at all. Also I wanted to delete most of the history in the DB, and it was impossible to find a working documentation explaining how to do that correctly and easily (I'm not even sure this is possible). You can easily remove some channels history from the DB, but doing the opposite, keeping the history only of some channel and removing all others doesn't appear to be easy.<li>Mattermost: I've tried to install mattermost, to install it, there is no package, you need to start a shell script as root that will erase and change your nginx configuration…. Seriously…<li>Rocket.chat, ho…. a nice word about the difference between community version and pro version… no thank you. I prefer something sustained by free software standards.<li>I tried XMPP, it was OK. But the clients weren't really good, I could have used bitlbee, the installation looked more complex than IRC.</ul><p>Finally, IRC + ZNC with replay module is the winner. It was the easiest and best solution.<ol><li>it works<li>it is frugal<li>it is old and stable<li>it is both minimalist and feature complete</ol><h1 id=tutorial>Tutorial</h1><p>Here is how to have a great private self-hosted IRC server to share with a small group of people.<p>If this appear to be too much work for you, you should simply use a service that host a znc bouncer for you (I found some apparently free services doing that) and find an IRC server allowing you to create some private channel.<h2 id=self-host>Self Host</h2><p>You might use an external IRC server. But it is a lot safer to self-host it.<p>Self-hosting might not be easy if you are not familiar about how to do that.<ol><li>buy a domain name<li>buy a machine (VPS, baremetal, host it at your home)<li>configure the DNS for your domain name go to your machine<li>configure letsencrypt to support wildcard hostnames<li>know how to create reverse proxy</ol><p>I couldn't find a nice resource to link to with all those details. This is certainly a call to write such an article myself.<h3 id=create-a-reverse-proxy-with-nginx>Create a reverse proxy with nginx</h3><p>This is how I create new reverse proxies with nginx using a template: <a href=./reverse-proxy-template.m4>reverse-proxy-template.m4</a>.<p>That I use with the following script: <a href=./new-reverse-proxy.sh>new-reverse-proxy.sh</a><div class=sourceCode id=cb1 data-tangle=new-reverse-proxy.sh><pre class="sourceCode bash"><code class="sourceCode bash"><span id=cb1-1><a href=#cb1-1 aria-hidden=true></a><span class=co>#!/usr/bin/env zsh</span></span>
<span id=cb1-2><a href=#cb1-2 aria-hidden=true></a></span>
<span id=cb1-3><a href=#cb1-3 aria-hidden=true></a><span class=kw>((</span><span class=va>$#</span>&lt;3<span class=kw>))</span> <span class=kw>&amp;&amp;</span> <span class=kw>{</span></span>
<span id=cb1-4><a href=#cb1-4 aria-hidden=true></a>  <span class=ex>print</span> <span class=st>&quot;usage: </span><span class=va>$0</span><span class=st>:t SUB DOMAIN PORT&quot;</span></span>
<span id=cb1-5><a href=#cb1-5 aria-hidden=true></a>  <span class=bu>exit</span> 1</span>
<span id=cb1-6><a href=#cb1-6 aria-hidden=true></a><span class=kw>}</span> <span class=op>&gt;&amp;2</span></span>
<span id=cb1-7><a href=#cb1-7 aria-hidden=true></a></span>
<span id=cb1-8><a href=#cb1-8 aria-hidden=true></a><span class=va>SUB=</span><span class=st>&quot;</span><span class=va>$1</span><span class=st>&quot;</span></span>
<span id=cb1-9><a href=#cb1-9 aria-hidden=true></a><span class=va>DOMAIN=</span><span class=st>&quot;</span><span class=va>$2</span><span class=st>&quot;</span></span>
<span id=cb1-10><a href=#cb1-10 aria-hidden=true></a><span class=va>PORT=</span><span class=st>&quot;</span><span class=va>$3</span><span class=st>&quot;</span></span>
<span id=cb1-11><a href=#cb1-11 aria-hidden=true></a></span>
<span id=cb1-12><a href=#cb1-12 aria-hidden=true></a><span class=fu>m4</span> -D SUB=<span class=va>$SUB</span> -D DOMAIN=<span class=va>$DOMAIN</span> -D PORT=<span class=va>$PORT</span> reverse-proxy-template.m4 <span class=op>&gt;</span> <span class=va>$SUB</span>.<span class=va>$DOMAIN</span></span></code></pre></div><p>The script will generate a reverse proxy nginx conf that I put in <code>/etc/nginx/sites-available/</code> and I link it in <code>/etc/nginx/sites-enabled</code>.<h2 id=install-configure-ngircd>Install/configure ngircd</h2><p>There are multiple IRC server. I gave my preference to <a href=https://github.com/ngircd/ngircd>ngircd</a> because it appeared lightweight, easy to install and configure.<p>So use your preferred package manager to install it:<pre><code>sudo apt-get install ngircd
</code></pre><p>Configure the <code>/etc/ngircd/ngircd.conf</code> file. I only show the really interesting lines for a private small IRC for a team.<pre class=gitconfig><code>[Global]
  Name = irc.your.domain
  Info = My Incredible IRC
  Password = privateIRCSecretPassword

[Options]
  # prevent channel creation
  AllowedChannelTypes = 

[SSL]
  Certfile = /etc/letsencrypt/live/your.domain/fullchain.pem
  Keyfile = /etc/letsencrypt/live/your.domain/privkey.pem
  Ports = 6667,9999

[Channel]
  # predefined channel
  Name = #general
  Topic = Main team channel
  MaxUsers = 23

[Channel]
  Name = #status
  Topic = Status update channel
  MaxUsers = 23
</code></pre><h2 id=install-configure-znc>Install/configure ZNC</h2><p>Install ZNC from sources or via your package manager. I choose sources. Choose the latest version if you can.<pre><code>&gt; wget https://znc.in/releases/archive/znc-1.7.5.tar.gz
&gt; tar xzf znc-1.7.5.tar.gz
&gt; cd znc-1.7.5
&gt; mkdir build
&gt; cd build
&gt; make
&gt; make install
</code></pre><p>Then create your config file for example via:<pre><code>&gt; znc --makeconf
</code></pre><p>For the question, keep buffers after replay, you should certainly answer yes. To use znc web interface behind an nginx reverse proxy:<pre class=conf><code> &lt;Listener listener0&gt;
        AllowIRC = false
        AllowWeb = true
        Host = localhost
        IPv4 = true
        IPv6 = false
        Port = 10001
        SSL = false
        URIPrefix = /
&lt;/Listener&gt;

&lt;Listener listener1&gt;
        AllowIRC = true
        AllowWeb = false
        IPv4 = true
        IPv6 = true
        Port = 10002
        SSL = true
        URIPrefix = /
&lt;/Listener&gt;
</code></pre><p>Now you can put your ZNC behind a reverse proxy.<p>In order not to miss any message in your clients you should keep a bouncer running for you that will keep all IRC messages. But in order to sync this history correctly among all your different IRC clients you should install the playback module. And if you wish to receive push notification you should also add a module for your application (in my case palaver).<h3 id=playback-module>Playback module</h3><p>In order not to miss any messages in all your clients you should add this <a href=https://wiki.znc.in/Playback>ZNC playback module</a>.<pre><code>&gt; cd ~/.znc/modules
&gt; wget https://raw.githubusercontent.com/jpnurmi/znc-playback/master/playback.cpp
&gt; znc-buildmod playback.cpp
</code></pre><p>Should create a <code>playback.so</code> in <code>~/.znc/modules</code>.<h3 id=palaver-push-module>Palaver push module</h3><p>You should find the ZNC push palaver module here:<p><a href=https://github.com/cocodelabs/znc-palaver>https://github.com/cocodelabs/znc-palaver</a><pre><code>&gt; git clone https://github.com/cocodelabs/znc-palaver znc-palaver
&gt; cd znc-palaver
&gt; znc-buildmod palaver.cpp
&gt; cp palaver.so ~/.znc/modules/
</code></pre><h3 id=configure-your-irc-servers>Configure your IRC servers</h3><p>Now you should be able to reach <code>znc.my.domain</code>. You should see something like<figure><img src=./znc-login.png.webp alt="ZNC Login Page"><figcaption aria-hidden=true>ZNC Login Page</figcaption></figure><p>Login with your admin user (set during the configuration or znc). Then go to your Global settings<figure><img src=./znc-global-settings.png.webp alt="ZNC Global Settings"><figcaption aria-hidden=true>ZNC Global Settings</figcaption></figure><p>And if you scroll down you should see a list of modules. Select the playback and palaver modules and save your preferences.<figure><img src=./znc-modules.png.webp alt="ZNC Modules"><figcaption aria-hidden=true>ZNC Modules</figcaption></figure><p>Then under the global settings, go to your User settings and scroll down to see the Flags:<figure><img src=./znc-user-settings-flags.png.webp alt="ZNC User Settings Flags"><figcaption aria-hidden=true>ZNC User Settings Flags</figcaption></figure><p>Take care to unselect the "Auto Clear Chan Buffer", "Auto Clear Query Buffer" and to select "Multi Clients". If you forget to do that, the playback plugin will not work as expected.<p>Finally add your IRC server to via the Network block (in your User Settings):<figure><img src=./znc-add-network.png.webp alt="ZNC Add Network"><figcaption aria-hidden=true>ZNC Add Network</figcaption></figure><p>From now on, you should always appear as a connected user to your IRC server. This is your ZNC bouncer reading all the messages for you even when you are not here.<h2 id=install-configure-clients>Install/configure clients</h2><h3 id=weechat>weechat</h3><p>Weechat the IRC client I use the most. It is terminal based, use very few resources, it is fast, dense and very nice to use.<ol><li><p>add the <a href=https://weechat.html/scripts/source/zncplayback.py.html/>weechat znc playback script</a><li><p>in weechat, set server capabilities<pre class=irc><code>/set irc.server_default.capabilities &quot;account-notify,away-notify,cap-notify,multi-prefix,server-time,znc.in/server-time-iso,znc.in/self-message,znc.in/playback
</code></pre><li><p>add your server<pre class=irc><code>/server add zncnetwork znc.my.domain/6697 -ssl -username=username/zncnetwork -password=password -autoconnect
/connect zncnetwork
</code></pre><li><p>save your confi with <code>/save</code></ol><p>More details here: <a href=https://wiki.znc.in/Weechat>https://wiki.znc.in/Weechat</a><h3 id=thelounge>thelounge</h3><p>Here are the infos for installing it.<p><a href=https://thelounge.chat/docs/install-and-upgrade>https://thelounge.chat/docs/install-and-upgrade</a><p>You can use my reverse proxy scripts to put the lounge behind a reverse proxy from your host. So you'll be able to reach <code>thelounge.my.domain</code>. Of course, connect the lounge via ZNC not directly to your IRC server.<h3 id=palaver>Palaver</h3><p>Using palaver should be straightfoward. There is a very clear ZNC configuration choice.<p>Here is its website: <a href=https://palaverapp.com>https://palaverapp.com</a><p>I previously used the app mutter, but it stopped to work after the iOS 13 update.<h1 id=bonus>Bonus</h1><h2 id=no-brainer-upload-file>No brainer upload file</h2><p>Quite often you want to share images/files in your chat. Instead of using a public channel, I preferred to create a minimalist (223 lines of haskell) private server for this purpose only.<p>It is highly inspired from the image uploader example of the Yesod web framework. It is a single self-executable file + one css and jquery. The only dependency is <a href=https://docs.haskellstack.html/en/stable/README/>stack</a>.<p>So to install it:<ol><li>install <a href=https://docs.haskellstack.html/en/stable/README/>stack</a><li><code>git clone https://gitlab.esy.fun/yogsototh/ymgur .</code><li>follow the README instructions to launch it<li>create an nginx reverse proxy protected with basic-auth<li>share the creds to your group members<li>enjoy</ol><section class=footnotes role=doc-endnotes><hr><ol><li id=fn1 role=doc-endnote><p>Here is a list of the chatting solutions I used for some time and finally abandoned (I certainly forgot a few ones):<ul><li>slack<li>matrix (self-hosted)<li>keybase<li>discord<li>gitter<li>XMPP (both hosted by a 3rd party and self-hosted)<li>IRC ← the winner</ul><a href=#fnref1 class=footnote-back role=doc-backlink>↩︎</a><li id=fn2 role=doc-endnote><p><a href=http://www.calnewport.com/books/digital-minimalism/>http://www.calnewport.com/books/digital-minimalism/</a><a href=#fnref2 class=footnote-back role=doc-backlink>↩︎</a><li id=fn3 role=doc-endnote><p>Fear Of Missing Out<a href=#fnref3 class=footnote-back role=doc-backlink>↩︎</a><li id=fn4 role=doc-endnote><p><a href=https://en.wikipedia.html/wiki/Embrace,_extend,_and_extinguish>Embrace, extend, and extinguish</a>.<a href=#fnref4 class=footnote-back role=doc-backlink>↩︎</a></ol></section></article></main><footer id=postamble class=status role=contentinfo><div class=content><nav role=navigation><a href=/index.html>Home</a> |
<a href=/slides.html>Slides</a> |
<a href=/about-me.html>About</a>
<span class=details>(<a href=https://gitea.esy.fun/yogsototh>code</a>
<a href=https://espial.esy.fun/u:yogsototh>bookmarks</a>
<a href=https://espial.esy.fun/u:yogsototh/notes>notes</a>)</span> |
<a href=#logo>↑ Top ↑</a></nav></div></footer></div>